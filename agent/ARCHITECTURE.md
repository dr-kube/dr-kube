# AI DrKube ì•„í‚¤í…ì²˜ ë° ì‘ì—… íë¦„

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ì‚¬ìš©ì (CLI)                              â”‚
â”‚                    run.bat / cli.py                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LangGraph Workflow                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  1ë‹¨ê³„   â”‚â”€â”€â”€â–¶â”‚  2ë‹¨ê³„   â”‚â”€â”€â”€â–¶â”‚  3ë‹¨ê³„   â”‚              â”‚
â”‚  â”‚ Load     â”‚    â”‚ Analyze  â”‚    â”‚ Suggest  â”‚              â”‚
â”‚  â”‚ Issue    â”‚    â”‚  (LLM)   â”‚    â”‚          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Google Gemini API (LLM)                         â”‚
â”‚           (gemini-pro / gemini-3-flash-preview)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ ì›Œí¬í”Œë¡œìš° ìƒì„¸

### 1ë‹¨ê³„: Load Issue (ì´ìŠˆ ë¡œë“œ)

**ì—­í• **: JSON íŒŒì¼ì—ì„œ Kubernetes ì´ìŠˆ ì •ë³´ ì½ê¸°

**ì…ë ¥**:
```json
{
  "id": "issue-001",
  "type": "pod_crash",
  "namespace": "production",
  "resource": "api-server-7d4f8b9c5-xyz",
  "error_message": "CrashLoopBackOff",
  "logs": [
    "2026-01-07T10:00:00Z Error: OOMKilled",
    "2026-01-07T10:00:00Z Container exceeded memory limit"
  ]
}
```

**ì¶œë ¥**:
```python
{
  "issue_data": {...},  # JSON íŒŒì‹± ê²°ê³¼
  "status": "loaded"
}
```

**ì½”ë“œ ìœ„ì¹˜**: [src/dr_kube/graph.py:10-17](agent/src/dr_kube/graph.py#L10-L17)

---

### 2ë‹¨ê³„: Analyze (AI ë¶„ì„)

**ì—­í• **: LLMì„ ì‚¬ìš©í•´ ì´ìŠˆì˜ ê·¼ë³¸ ì›ì¸ê³¼ í•´ê²°ì±… ë¶„ì„

#### 2-1. í”„ë¡¬í”„íŠ¸ ìƒì„±

**í…œí”Œë¦¿**: [src/dr_kube/prompts.py](agent/src/dr_kube/prompts.py)

```
ë‹¹ì‹ ì€ Kubernetes ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ë‹¤ìŒ K8s ì´ìŠˆë¥¼ ë¶„ì„í•˜ê³  ê°„ê²°í•˜ê²Œ í•´ê²°ì±…ì„ ì œì‹œí•´ì£¼ì„¸ìš”.

## ì´ìŠˆ ì •ë³´
- íƒ€ì…: pod_crash
- ë„¤ì„ìŠ¤í˜ì´ìŠ¤: production
- ë¦¬ì†ŒìŠ¤: api-server-7d4f8b9c5-xyz
- ì—ëŸ¬ ë©”ì‹œì§€: CrashLoopBackOff

## ë¡œê·¸
2026-01-07T10:00:00Z Error: OOMKilled
...

## ìš”ì²­ì‚¬í•­
ê·¼ë³¸ ì›ì¸: [í•œ ë¬¸ì¥ìœ¼ë¡œ ì„¤ëª…]
ì‹¬ê°ë„: [critical/high/medium/low]
í•´ê²°ì±…:
1. [ì¦‰ì‹œ ì¡°ì¹˜]
2. [ê·¼ë³¸ í•´ê²°]
3. [ëª¨ë‹ˆí„°ë§]
```

#### 2-2. LLM í˜¸ì¶œ

**LLM í”„ë¡œë°”ì´ë”**: [src/dr_kube/llm.py](agent/src/dr_kube/llm.py)

```python
# Google Gemini API í˜¸ì¶œ
llm = ChatGoogleGenerativeAI(
    model="gemini-3-flash-preview",
    google_api_key="...",
    temperature=0.3
)
response = llm.invoke(prompt)
```

#### 2-3. ì‘ë‹µ íŒŒì‹±

**íŒŒì‹± ë¡œì§**: [src/dr_kube/graph.py:57-88](agent/src/dr_kube/graph.py#L57-L88)

AI ì‘ë‹µì—ì„œ ë‹¤ìŒ ì •ë³´ ì¶”ì¶œ:
- `root_cause`: "ê·¼ë³¸ ì›ì¸:" ë’¤ì˜ í…ìŠ¤íŠ¸
- `severity`: critical/high/medium/low ì¤‘ í•˜ë‚˜
- `suggestions`: ë²ˆí˜¸ê°€ ë¶™ì€ í•´ê²°ì±… ë¦¬ìŠ¤íŠ¸

**ì¶œë ¥**:
```python
{
  "analysis": "ì „ì²´ AI ì‘ë‹µ í…ìŠ¤íŠ¸",
  "root_cause": "ì»¨í…Œì´ë„ˆê°€ ë©”ëª¨ë¦¬ ì œí•œ ì´ˆê³¼ë¡œ ê°•ì œ ì¢…ë£Œ",
  "severity": "high",
  "suggestions": [
    "resources.limits.memoryë¥¼ 1Gi ì´ìƒìœ¼ë¡œ ì¦ì„¤",
    "ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì—¬ë¶€ í”„ë¡œíŒŒì¼ë§",
    "ë©”ëª¨ë¦¬ 80% ì´ˆê³¼ ì‹œ ì•Œë¦¼ ì„¤ì •"
  ],
  "action_plan": "kubectl patch deployment api-server ...",
  "yaml_diff": "spec:\n  resources:\n-   memory: 512Mi\n+   memory: 1Gi",
  "status": "analyzed"
}
```

---

### 3ë‹¨ê³„: Suggest (ê²°ê³¼ ì™„ë£Œ)

**ì—­í• **: ì›Œí¬í”Œë¡œìš° ì™„ë£Œ í‘œì‹œ

**ì¶œë ¥**:
```python
{
  "status": "done"
}
```

---

## ğŸ¯ ì „ì²´ ë°ì´í„° íë¦„

```
ì´ìŠˆ íŒŒì¼ (JSON)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  load_issue()   â”‚  ì´ìŠˆ ë°ì´í„° ì½ê¸°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ issue_data
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   analyze()     â”‚  AI ë¶„ì„ ìš”ì²­
â”‚                 â”‚
â”‚  1. í”„ë¡¬í”„íŠ¸ ìƒì„±â”‚  (ì´ìŠˆ ì •ë³´ â†’ í…ìŠ¤íŠ¸)
â”‚  2. LLM í˜¸ì¶œ    â”‚  (Gemini API)
â”‚  3. ì‘ë‹µ íŒŒì‹±   â”‚  (í…ìŠ¤íŠ¸ â†’ êµ¬ì¡°í™”)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ root_cause, severity, suggestions
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   suggest()     â”‚  ì™„ë£Œ í‘œì‹œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
     CLI ì¶œë ¥
```

## ğŸ“Š ìƒíƒœ ê´€ë¦¬ (State)

**ìƒíƒœ ì •ì˜**: [src/dr_kube/state.py](agent/src/dr_kube/state.py)

```python
class IssueState(TypedDict):
    # ì…ë ¥
    issue_file: str          # ì´ìŠˆ íŒŒì¼ ê²½ë¡œ
    issue_data: dict         # íŒŒì‹±ëœ ì´ìŠˆ ë°ì´í„°

    # ë¶„ì„ ê²°ê³¼
    analysis: str            # AI ì „ì²´ ì‘ë‹µ
    root_cause: str          # ê·¼ë³¸ ì›ì¸
    severity: str            # critical/high/medium/low
    suggestions: list[str]   # í•´ê²°ì±… ë¦¬ìŠ¤íŠ¸
    action_plan: str         # kubectl ëª…ë ¹ì–´ ë“± ì‹¤í–‰ ê³„íš (NEW)
    yaml_diff: str           # YAML ìˆ˜ì • diff (NEW)

    # ë©”íƒ€
    status: str              # loaded/analyzed/done
    error: str               # ì—ëŸ¬ ë©”ì‹œì§€
```

LangGraphê°€ ì›Œí¬í”Œë¡œìš°ì˜ ê° ë‹¨ê³„ ì‚¬ì´ì—ì„œ ì´ ìƒíƒœë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.

---

## ğŸ”§ ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### 1. LLM í”„ë¡œë°”ì´ë” (llm.py)

**ê¸°ëŠ¥**: í™˜ê²½ ë³€ìˆ˜ì— ë”°ë¼ LLM ì„ íƒ

```python
# Google Gemini ì‚¬ìš© (GOOGLE_API_KEY ì„¤ì • ì‹œ)
if api_key:
    return ChatGoogleGenerativeAI(...)

# Ollama ì‚¬ìš© (ê¸°ë³¸ê°’)
return ChatOllama(...)
```

**í™˜ê²½ ë³€ìˆ˜**:
- `GOOGLE_API_KEY`: Gemini API í‚¤
- `MODEL_NAME`: ì‚¬ìš©í•  ëª¨ë¸ (gemini-pro, gemini-3-flash-preview ë“±)

### 2. í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ (prompts.py)

**í•µì‹¬ ì „ëµ**:
- âœ… ì—­í•  ì •ì˜: "Kubernetes ì „ë¬¸ê°€"
- âœ… ê°„ê²°ì„± ê°•ì¡°: "í•œ ì¤„ë¡œ í•µì‹¬ë§Œ"
- âœ… êµ¬ì¡°í™”ëœ ì¶œë ¥: ê·¼ë³¸ ì›ì¸, ì‹¬ê°ë„, í•´ê²°ì±…
- âœ… 3ë‹¨ê³„ í•´ê²°ì±…: ì¦‰ì‹œ/ê·¼ë³¸/ëª¨ë‹ˆí„°ë§

### 3. ì›Œí¬í”Œë¡œìš° ê·¸ë˜í”„ (graph.py)

**LangGraph ì‚¬ìš©**:
```python
workflow = StateGraph(IssueState)

# ë…¸ë“œ ì¶”ê°€
workflow.add_node("load_issue", load_issue)
workflow.add_node("analyze", analyze)
workflow.add_node("suggest", suggest)

# ìˆœì°¨ì  ì‹¤í–‰ ì •ì˜
workflow.set_entry_point("load_issue")
workflow.add_edge("load_issue", "analyze")
workflow.add_edge("analyze", "suggest")
workflow.add_edge("suggest", END)
```

---

## ğŸ¨ CLI ì¶œë ¥ í¬ë§¤íŒ…

**ì¶œë ¥ ë¡œì§**: [src/cli.py:35-68](agent/src/cli.py#L35-L68)

### ê¸°ë³¸ ì¶œë ¥
```
============================================================
  DR-Kube ë¶„ì„ ê²°ê³¼
============================================================

ğŸ“‹ ì´ìŠˆ: CrashLoopBackOff
ğŸ“¦ ë¦¬ì†ŒìŠ¤: api-server-7d4f8b9c5-xyz
ğŸŸ  ì‹¬ê°ë„: HIGH

ğŸ” ê·¼ë³¸ ì›ì¸:
   ì»¨í…Œì´ë„ˆê°€ ë©”ëª¨ë¦¬ ì œí•œ ì´ˆê³¼ë¡œ ê°•ì œ ì¢…ë£Œ

ğŸ’¡ í•´ê²°ì±…:
   1. resources.limits.memoryë¥¼ 1Gië¡œ ì¦ì„¤
   2. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í”„ë¡œíŒŒì¼ë§
   3. ë©”ëª¨ë¦¬ 80% ì´ˆê³¼ ì‹œ ì•Œë¦¼ ì„¤ì •

============================================================
```

### Verbose ì¶œë ¥ (-v ì˜µì…˜)
```
... (ê¸°ë³¸ ì¶œë ¥) ...

ğŸ“„ ì „ì²´ ë¶„ì„ ë‚´ìš©:
------------------------------------------------------------
ê·¼ë³¸ ì›ì¸: ...
ì‹¬ê°ë„: high
í•´ê²°ì±…:
1. ...
2. ...
3. ...
============================================================
```

---

## ğŸš€ í™•ì¥ ê°€ëŠ¥ì„±

### í˜„ì¬ êµ¬ì¡°ì˜ ì¥ì 

1. **ëª¨ë“ˆí™”**: ê° ë‹¨ê³„ê°€ ë…ë¦½ì ì¸ í•¨ìˆ˜
2. **LangGraph**: ë³µì¡í•œ ì›Œí¬í”Œë¡œìš° ì¶”ê°€ ìš©ì´
3. **í”„ë¡œë°”ì´ë” ì¶”ìƒí™”**: LLM ì‰½ê²Œ êµì²´ ê°€ëŠ¥
4. **ìƒíƒœ ê¸°ë°˜**: ì—ëŸ¬ ì²˜ë¦¬ ë° ë””ë²„ê¹… ì‰¬ì›€

### í–¥í›„ ì¶”ê°€ ê°€ëŠ¥í•œ ê¸°ëŠ¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load    â”‚â”€â”€â”€â–¶â”‚ Analyze  â”‚â”€â”€â”€â–¶â”‚ Generate â”‚â”€â”€â”€â–¶â”‚  Apply   â”‚
â”‚  Issue   â”‚    â”‚  (LLM)   â”‚    â”‚  Fix     â”‚    â”‚  (K8s)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â–¼
                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                 â”‚  Verify  â”‚
                                                 â”‚  Fixed   â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¶”ê°€ ê°€ëŠ¥í•œ ë…¸ë“œ**:
- `generate_fix`: YAML íŒ¨ì¹˜ ìë™ ìƒì„±
- `apply_fix`: kubectl apply ì‹¤í–‰
- `verify_fixed`: ì ìš© í›„ ê²€ì¦
- `rollback`: ì‹¤íŒ¨ ì‹œ ë¡¤ë°±

---

## ğŸ” ë””ë²„ê¹… ë° ëª¨ë‹ˆí„°ë§

### ë¡œê·¸ í™•ì¸
```python
# .env íŒŒì¼
LOG_LEVEL=DEBUG
```

### ìƒíƒœ í™•ì¸
ê° ë…¸ë“œì—ì„œ ë°˜í™˜ë˜ëŠ” ìƒíƒœë¥¼ í™•ì¸:
```python
result = graph.invoke({"issue_file": "..."})
print(result)  # ì „ì²´ ìƒíƒœ ì¶œë ¥
```

### Verbose ëª¨ë“œ
```cmd
run.bat issues\sample_oom.json -v
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

- **LangGraph**: https://langchain-ai.github.io/langgraph/
- **LangChain**: https://python.langchain.com/
- **Google Gemini**: https://ai.google.dev/
- **Kubernetes**: https://kubernetes.io/docs/

## ğŸ¯ ìš”ì•½

1. **ì´ìŠˆ ë¡œë“œ**: JSON íŒŒì¼ â†’ Python dict
2. **AI ë¶„ì„**: í”„ë¡¬í”„íŠ¸ ìƒì„± â†’ Gemini í˜¸ì¶œ â†’ ì‘ë‹µ íŒŒì‹±
3. **ê²°ê³¼ ì¶œë ¥**: êµ¬ì¡°í™”ëœ í¬ë§·ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ í‘œì‹œ

ëª¨ë“  ê³¼ì •ì€ LangGraphì˜ ìƒíƒœ ë¨¸ì‹ ìœ¼ë¡œ ê´€ë¦¬ë˜ë©°, ê° ë‹¨ê³„ëŠ” ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ë° í™•ì¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.
