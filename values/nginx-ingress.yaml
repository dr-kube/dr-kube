# https://artifacthub.io/packages/helm/ingress-nginx/ingress-nginx
# NGINX Ingress Controller Helm Values
# https://kubernetes.github.io/ingress-nginx/

controller:
  # 단일 컨트롤러 파드로 고정
  replicaCount: 1

  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 1

  # hostPort(80/443) 환경에서는 롤링 시 2개 동시 기동이 불가하므로
  # 새 파드 선기동(maxSurge)을 막고 1개씩 교체
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 0
      maxUnavailable: 1

  resources:
    requests:
      cpu: 100m
      memory: 90Mi

  # Kind 환경: hostPort로 80/443 직접 바인딩 (포트포워딩 불필요)
  hostPort:
    enabled: true

  # Kind control-plane 노드에 배치 (extraPortMappings 대상)
  nodeSelector:
    node-role.kubernetes.io/control-plane: ""

  tolerations:
    - key: node-role.kubernetes.io/control-plane
      operator: Exists
      effect: NoSchedule

  # Service 설정
  service:
    type: NodePort
    nodePorts:
      http: 30010
      https: 30011

  # Ingress Class 설정
  ingressClassResource:
    default: true

  # 메트릭 수집 (Prometheus)
  metrics:
    enabled: true
    serviceMonitor:
      enabled: false  # Prometheus Operator 미사용이면 비활성화

  # 로그 설정
  config:
    log-format-upstream: '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" $request_length $request_time [$proxy_upstream_name] [$proxy_alternative_upstream_name] $upstream_addr $upstream_response_length $upstream_response_time $upstream_status $req_id'
    use-forwarded-headers: "true"
    compute-full-forwarded-for: "true"

# Default Backend (선택사항)
defaultBackend:
  enabled: true
  replicaCount: 1
  resources: {}
  # limits:
  #   cpu: 10m
  #   memory: 20Mi
  # requests:
  #   cpu: 10m
  #   memory: 20Mi
