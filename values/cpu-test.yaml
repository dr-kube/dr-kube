# DR-Kube CPU Throttle 테스트용 애플리케이션
# CPU limit을 워크로드 수준에 맞게 상향 조정하여 throttling 해결

app:
  name: cpu-test
  namespace: default

  replicas: 1

  container:
    name: cpu-stress
    image: polinux/stress
    tag: latest

    command:
      - "stress"

    resources:
      requests:
        memory: "64Mi"
        cpu: "1000m"  # 안정적인 자원 확보를 위해 상향 조정
      limits:
        memory: "256Mi"
        cpu: "2000m"  # stress 워커 수(2개)에 맞춰 CPU Throttling이 발생하지 않도록 2000m으로 상향

    args:
      - "--cpu"
      - "2"         # CPU 워커 2개 (2000m 사용량에 해당)
      - "--timeout"
      - "3600"      # 1시간 실행

  labels:
    scenario: cpu-throttle
    managed-by: dr-kube