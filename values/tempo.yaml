# Grafana Tempo (Jaeger 대체, Grafana Drilldown 네이티브 지원)
# https://github.com/grafana/helm-charts/tree/main/charts/tempo
tempo:
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1
      memory: 2Gi
  receivers:
    otlp:
      protocols:
        grpc:
          endpoint: 0.0.0.0:4317
  # metrics generator - Grafana Drilldown에서 TraceQL 메트릭 제공
  metricsGenerator:
    enabled: true
    remoteWriteUrl: "http://prometheus-server.monitoring:80/api/v1/write"
    # processor별 설정 (local_blocks 필수!)
    processor:
      local_blocks: {}
      service_graphs:
        wait: 10s
        max_items: 10000
      span_metrics:
        enable_target_info: true
  # local-blocks 프로세서 활성화 (Drilldown 서버사이드 메트릭)
  overrides:
    defaults:
      metrics_generator:
        processors:
          - local-blocks
          - service-graphs
          - span-metrics

# in-memory 스토리지 (로컬 개발 환경)
storage:
  trace:
    backend: local
    local:
      path: /var/tempo/traces
    wal:
      path: /var/tempo/wal

persistence:
  enabled: true
  storageClassName: standard
  size: 5Gi
